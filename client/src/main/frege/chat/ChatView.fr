
module chat.ChatView where

import fregefx.JavaFxType
import fregefx.JavaFxAll hiding (ListView)
import fregefx.JavaFxUtils

totalWidth   = 800.0
totalHeight  = 600.0

main args = do
    FregeFX.launch $ withStage buildUI

getPostings âˆ· IO [String]
getPostings = do
    println "in getPostings"
    return  ["first","second","third"]

buildUI :: Group -> Stage -> JFX Group
buildUI root stage = do
    stage.setTitle "Frege Chat"
    stage.setWidth  totalWidth
    stage.setHeight totalHeight
    
    senderField <- TextField.new "Your name"
    messageArea <- TextArea.new  "Your message"
    chatArea    <- TextArea.new  "xxx" :: JFX TextArea
    

    pane <- Pane.new () :: JFX Pane
    root <: do
        pane `addNode` do
            r <- Rectangle.new 0.0 0.0 totalWidth totalHeight
            r.setStyle "-fx-fill:radial-gradient(center 25% 25%, radius 60%, reflect, red, black );"
            return r
        pane <: do
            vbox <- VBox.new 5d :: JFX VBox
            vbox.setPadding =<< insets 10
            vbox <: return senderField
            vbox <: return messageArea
            vbox <: do
                button <- Button.new "Send"    
                bridgeAction button (getPostings) (chatArea.setText . show)
            vbox <: return chatArea

    scene <- stage.getScene
    getPostings `thenDo` (onChatLoaded chatArea)

    return root

onChatLoaded :: TextArea -> [String] -> JFX ()
onChatLoaded chatArea postings = do
    chatArea.setText $ show postings

